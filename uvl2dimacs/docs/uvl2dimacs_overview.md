# UVL2Dimacs Component Overview

## Purpose

UVL2Dimacs converts Universal Variability Language (UVL) feature models into DIMACS CNF format, enabling SAT-based analysis of feature model properties.

This component is the first stage of the [Strong4VM](../../docs/html/index.html) pipeline.

## UVL Grammar Support

### Feature Trees

UVL2Dimacs supports the complete UVL 2.0 feature tree structure:

**Feature Types**:
- **Root Feature**: Top-level feature of the model
- **Mandatory Features**: Must be selected if parent is selected
- **Optional Features**: May be selected if parent is selected

**Group Types**:
- **Or Groups**: At least one child must be selected when parent is selected
- **Alternative Groups**: Exactly one child must be selected when parent is selected
- **Cardinality Groups**: Between n and m children must be selected (e.g., `[2..4]`)

### Cross-Tree Constraints

Supports Boolean constraints across features:
- `requires`: Feature A requires feature B
- `excludes`: Feature A excludes feature B
- Arbitrary Boolean expressions with `&`, `|`, `!`, `=>`, `<=>`

### Example UVL Model

```
features
    Car
        mandatory
            Engine
        optional
            GPS
            Bluetooth
        alternative
            ManualTransmission
            AutomaticTransmission
        or
            AirConditioning
            HeatedSeats

constraints
    GPS => Bluetooth
    ManualTransmission excludes AutomaticTransmission
```

## Conversion Modes

### Straightforward Mode (Default)

**Algorithm**:
1. Convert constraints to Negation Normal Form (NNF)
2. Apply distribution law to obtain CNF
3. Generate clauses directly from formulas

**Characteristics**:
- **Fewer variables**: No auxiliary variables introduced
- **Potentially longer clauses**: Distribution can create large clauses
- **Better for**: Simple constraints, smaller models

**When to Use**:
- Default choice for most models
- Simple Boolean constraints
- When variable count is a concern

### Tseitin Mode

**Algorithm**:
1. Introduce auxiliary variables for subexpressions
2. Generate equivalence clauses for each subexpression
3. Result is always in 3-CNF form

**Characteristics**:
- **More variables**: Auxiliary variables for each subexpression
- **Shorter clauses**: Maximum 3 literals per clause
- **Predictable structure**: Uniform clause length

**When to Use**:
- Complex nested Boolean formulas
- When 3-CNF format is required
- To avoid exponential clause explosion

**Example**:
```
Input: (a | b) & (c | d)
Straightforward: 4 clauses directly
Tseitin: Introduces aux variable, more clauses but simpler structure
```

## CNF Encoding

### Feature Relationships

Each UVL relationship type has specific CNF encoding:

**Mandatory Relationship** (parent → child):
```
Clauses: (¬parent ∨ child)
```

**Optional Relationship** (child may be selected):
```
Clauses: (¬child ∨ parent)
```

**Or Group** (at least one child):
```
Clauses: (¬parent ∨ child1 ∨ child2 ∨ ... ∨ childn)
         (¬childi ∨ parent) for each child i
```

**Alternative Group** (exactly one child):
```
Clauses: Or-group clauses +
         (¬childi ∨ ¬childj) for all pairs i,j where i≠j
```

**Cardinality Group** [n..m]:
```
Clauses: At-least-n encoding + At-most-m encoding
```

### Variable Mapping

Variables are mapped sequentially:
```
Feature "Car" -> Variable 1
Feature "Engine" -> Variable 2
Feature "GPS" -> Variable 3
...
```

DIMACS comments preserve this mapping:
```
c 1 Car
c 2 Engine
c 3 GPS
```

## Integration with Strong4VM

UVL2Dimacs is the entry point for UVL-based analysis:

```
UVL File → UVL2Dimacs → DIMACS CNF → Dimacs2Graphs → Graphs
```

The generated DIMACS file includes:
- Standard CNF format
- Variable-to-feature mapping comments
- Formula statistics (variables, clauses)

## API Usage

### Basic Conversion

```cpp
#include <uvl2dimacs/UVL2Dimacs.hh>

uvl2dimacs::UVL2DimacsAPI converter;
bool success = converter.convertFile("model.uvl", "output.dimacs");
```

### Advanced Options

```cpp
uvl2dimacs::ConversionOptions options;
options.mode = uvl2dimacs::TransformationMode::Tseitin;
options.verbose = true;

bool success = converter.convertFile("model.uvl", "output.dimacs", options);
```

## Output Format

**DIMACS CNF Header**:
```
c Generated by UVL2Dimacs
c Feature mapping:
c 1 FeatureName1
c 2 FeatureName2
p cnf <num_vars> <num_clauses>
<clause1> 0
<clause2> 0
...
```

Each clause is a space-separated list of literals (positive or negative integers) terminated by 0.

## Limitations

1. **Feature Cardinality**: Unbounded cardinality `[1..*]` not supported
2. **Arithmetic Constraints**: Filtered out (requires SMT, not SAT)
3. **No Optimization**: Generated CNF not minimized

See [Strong4VM Limitations](../../docs/html/limitations.html) for details.

## Building

```bash
# From uvl2dimacs directory
make all               # Build everything
make uvl2dimacs        # Build CLI only
make api               # Build API only
make examples          # Build API examples

# Generate documentation
make docs
```

## Examples

See `api/examples/` for usage examples:
- `simple_convert.cc` - Basic conversion
- `batch_convert.cc` - Batch processing

## Related Documentation

- [Strong4VM Main Documentation](../../docs/html/index.html)
- API Reference: @ref uvl2dimacs::UVL2DimacsAPI
- [UVL Specification](https://universal-variability-language.github.io/)
